name: SAST - CodeQL                               

on:                                               
  push:                                           
    branches: [ "main", "master" ]                
  pull_request:                                   
    branches: [ "main", "master" ]
  schedule:                                       
    - cron: "0 3 * * *"                           

permissions:                                      # минимальные права GITHUB_TOKEN
  actions: read
  contents: read
  security-events: write                          # нужно для выгрузки SARIF

jobs:                                             
  analyze:
    name: Analyze with CodeQL                     
    runs-on: ubuntu-latest                        
    strategy:
      fail-fast: false                            # не отменять остальные матрицы при сбое
      matrix:
        language: [ 'javascript' ]                # JS покрывает и TS в CodeQL

    steps:                                        
      - name: Checkout
        uses: actions/checkout@v4                 # забрать код репозитория

      - name: Initialize CodeQL
        uses: github/codeql-action/init@v3        # инициализация анализатора
        with:
          languages: ${{ matrix.language }}       # передаём язык из матрицы

      - name: Build project
        run: |                                    # сборка, чтобы CodeQL «понял» проект
          npm ci || pnpm install || yarn install  
          npm run build || pnpm build || yarn build

      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v3     # запустить анализ
        with:
          category: "/language:${{ matrix.language }}"  # пометка отчёта
